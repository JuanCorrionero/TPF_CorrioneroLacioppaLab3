--TP FINAL LABORATORIO III (TURNO NOCHE) 1ER CUATRIMESTRE NOCHE 2020
--PROFESOR ANGEL SIMON
--JUAN IGNACIO Y NACHO LACIOPPA

CREATE DATABASE TALLER_CL
GO
USE TALLER_CL
GO

-------TABLAS-------

--TECNICOS
CREATE TABLE TECNICOS(
	ID INT NOT NULL IDENTITY(1,1),
	--LOGUEO AL SISTEMA
	USUARIO VARCHAR(10) NOT NULL,
	CONTRASEÃ‘A NVARCHAR(10) NOT NULL,
	--IDPERFIL INT NOT NULL FOREIGN KEY REFERENCES PERFILES_TECNICOS(ID),
	--DATOS PERSONALES
	NOMBRE VARCHAR(30) NOT NULL,
	APELLIDO VARCHAR(30) NOT NULL,
	DNI VARCHAR(10) NOT NULL,
	SUELDO MONEY NULL,
	ESTADO BIT NOT NULL
	)

--CLIENTES
CREATE TABLE CLIENTES(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	NOMBRE VARCHAR(30) NOT NULL,
	APELLIDO VARCHAR(30) NOT NULL,
	DNI VARCHAR(10) NOT NULL,
	DIRECCION VARCHAR(15) NULL,
	LOCALIDAD VARCHAR(15) NULL,
	TELEFONO VARCHAR(10) NULL,
	MAIL VARCHAR(50) NULL,
	ESTADO BIT NOT NULL
	)

--REPUESTOS
CREATE TABLE REPUESTOS(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	CODIGO NVARCHAR(50) NOT NULL,
	NOMBRE NVARCHAR(30) NOT NULL,
	CANTIDAD BIGINT NOT NULL,
	PRECIO MONEY NOT NULL CHECK(PRECIO > 0),
	IDCATEGORIA INT NOT NULL FOREIGN KEY REFERENCES CATEGORIAS_REPUESTOS(ID),
	ESTADO BIT NOT NULL
	)

--CATEGORIA POR REPUESTOS
CREATE TABLE CATEGORIAS_REPUESTOS(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	NOMBRE VARCHAR(15) NOT NULL,
	ESTADO BIT NOT NULL
	)

--PERFILES TECNICOS (ADMIN, RECEPCION Y TECNICO EN REPARACION)
CREATE TABLE PERFILES_TECNICOS(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	NOMBRE VARCHAR(15) NOT NULL,
	ESTADO BIT NOT NULL,
	)

--EQUIPOS 
CREATE TABLE EQUIPOS(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	NUMEROSERIE NVARCHAR(50) NOT NULL,
	CATEGORIA NVARCHAR(50) NULL,
	MARCA NVARCHAR(50) NULL,
	MODELO NVARCHAR(50) NULL
	)

--ESTADOS POR REPARACION (SIN REVISAR, EN REPARACION, A PRESUPUESTAR, FINALIZADO Y SIN REPARACION)
CREATE TABLE ESTADOS_REPARACION(
	ID INT NOT NULL PRIMARY KEY IDENTITY (1,1),
	NOMBRE VARCHAR(15) NOT NULL
	)

--REPARACIONES
CREATE TABLE REPARACIONES(
--entrada
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	ORDEN BIGINT NOT NULL UNIQUE,
	IDCLIENTE INT NOT NULL FOREIGN KEY REFERENCES CLIENTES(ID),
	IDEQUIPO INT NOT NULL FOREIGN KEY REFERENCES EQUIPOS(ID),
	--SOLO ADMIN O RECEPCION
	IDTECNICO INT NOT NULL FOREIGN KEY REFERENCES TECNICOS(ID),
	IDESTADO INT NOT NULL FOREIGN KEY REFERENCES ESTADOS_REPARACION(ID),
	PROBLEMA NVARCHAR(MAX) NULL,
	FECHA_ENTRADA smalldatetime NOT NULL,
--salida
	INFORME NVARCHAR(MAX) NULL,
	PRECIO MONEY NULL,
	FECHA_SALIDA smalldatetime NULL,
)

--REPUESTOS POR REPARACION
CREATE TABLE REPUESTOS_POR_REPARACIONES(
	ID INT NOT NULL PRIMARY KEY IDENTITY(1,1),
	IDREPARACIONES INT NOT NULL FOREIGN KEY REFERENCES REPARACIONES(ID),
	IDREPUESTO INT NOT NULL FOREIGN KEY REFERENCES REPUESTOS(ID)
)

--CONSTRAINTS
ALTER TABLE TECNICOS
ADD CONSTRAINT PK_Tecnico PRIMARY KEY (ID);

ALTER TABLE TECNICOS
ADD FOREIGN KEY (IDPERFIL) REFERENCES Usuario(ID);

